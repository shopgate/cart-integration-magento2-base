dist: xenial
sudo: false
language: php

install:
  - phpenv config-rm xdebug.ini || return 0
# todo-sg: need to install magento2 to run tests as it uses the bootstrap file in dev folder
#- echo "{\"http-basic\":{\"repo.magento.com\":{\"username\":\"${MAGENTO_USERNAME}\",\"password\":\"${MAGENTO_PASSWORD}\"}}}" > auth.json
#- if [[ "$MAGENTO_USERNAME" ]]; then composer install ; fi
script:
  - curl -L https://cs.symfony.com/download/php-cs-fixer-v2.phar -o php-cs-fixer
  - chmod a+x php-cs-fixer
  - git checkout -B $TRAVIS_BRANCH
  - ./php-cs-fixer fix --config=.php-cs.dist --cache-file=.php-cs.cache --diff --dry-run --verbose
  - rm php-cs-fixer

jobs:
  include:
    - stage: Code Style
      php: '7.2'
    - php: '7.1'
      dist: trusty
    - stage: deploy
      php: '7.1'
      before_script: skip
      script:
        - if [[ "$TRAVIS_TAG" ]]; then
          chmod +x ./release/build_release_package.sh;
          ./release/build_release_package.sh;
          fi
      deploy:
        provider: releases
        api_key:
          secure: "wqBQjTz/WlTJ/466OGORSDghHMK74u3rXILa9WTex30gHc4WjirozR2x6L8PUeyUx0sIrcJMLt/Qk+6v7UXn2oPOadzvrA/S62dYs6TZCv72PN5QO5ZUqugT8M4GCveJxSWGfhvxpMdSEfqDd3IFqUDsRV9/uq6/twRpWvPA0j0Up2MZ66GxCaCaLi0oeViDGtP83dFNnSBD6+HbczzDpfdoDB84ajfbKQ8DCwlqSM+5vBigKWM6HXJH2+poi04frSRbKbGCypTERqeIe8tnQUzYLHJkMTezhOtlW6ua82gbiN7QA2RG5ViSBvrZ2sJq5UsTo9SWgGGY4C5Q/w4hheHvUhAf0vbvhvyUZRNfok42k6b34N2XJhGK3dLANUTkwgZssVJOse+rDwLoDbdo4v01uwngbOChjbAcfRkN4B12DYk5RsX7IXzTofyNxu3jlPEybHMR5sP2Vkc9kuXG9OaxYrh651lL/yHD2ltvuYOu7BGJ5En3iileLBrVqZr5hP181A1P36OByAcABSb1Wn3wjY8O0z1oFucT78SDsqGpYtO46BhYO97kLj1eE9FxNRB8Da5rRZiSxMAVZlLrm9j2rJc4T+VqbTKtBwuTxRTcxHGbqd6gltipI+pOGxBLwtU0gXHqdKtxQarOJqB2Uy8Y8LsJgoPAj8tmmGSWbyk="
        file: shopgate-base-${TRAVIS_TAG}.zip
        skip_cleanup: true
        on:
          tags: true

notifications:
  slack:
    rooms:
      - secure: "QCOIv7rDYuXToHiQWcIEowsXbzW474zOmX0b3OgGaEuXxIA4IERc6aY+Hms37kTtjHzFYCWzgwteTMGG9E5gyQglx0fbZ2dJ26jRq+fAzCC4jJmTEsANUVfWZlFwedNy2lLmr0cOWXK76KLI1CozgBai2VY/C2z1sMNx5ZYm+1IkXY6oYE6rkF8xkRiu8UO+PNAMOXhsEy8DqrgPr9Ev1JBnKW8A9K19fv+XVs4+BRkCebKH64dBLaYjHhjJGUhX/ksX7KpHYjZhckF5rw9ZBEpZixyGRcpPWNuo+LcLFznlophUXy6XPnw0E5lV3GEgjg+YP2xPee9dIGrXqV5cs2vQQaN5IKrJUPFkmbCdiWdQC8pOj8HM9fj2BOD0mk8yVisvC5ZXnL+pnHmNmxfr8pbxjhHsijMQdNeWoludsM5BZSAcmIL4MVEIBut8QXU79yMqEgjrSx8AouyyzOVP0nkOa5TD6cyHyJjgi7JY5HVD2hEpIk086kw0eGbrFoVzPavtnS8/o3LkyptsIkRfpHuRhesseuTPzX11N3XFNvMBnfZ/4KSa6WiAElsjKaYH87hpYWcVuveSEtYgol0aFGpGop4Y7Qn0IyqrLfZu0w8b+L1PPFRRiX1tEjMCBLfWwL0DlvrMszt1xyWE6S8Ig5qcqZ4yzCk5iWYXDcwKwao="
    on_success: change
    on_failure: always
