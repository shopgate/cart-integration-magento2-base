{
  "info": {
    "_postman_id": "11cd6695-b691-4b9c-bca7-69ab498d4b00",
    "name": "Mage2",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "set_settings",
      "item": [
        {
          "name": "5th item is not skipped",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "b54f00de-f1b5-4643-97be-44b5e74d462b",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Has 5 items\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(Object.keys(jsonObject.items.item).length).to.eq(5);",
                  "});",
                  "",
                  "pm.test(\"Last item is with UID 5\", function () {",
                  "    body = cheerio(responseBody);",
                  "    uid5 = body.find(\"item[uid='5']\").html();",
                  "    pm.expect(uid5).to.not.eq(null);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "limit",
                  "value": "5",
                  "description": "\n",
                  "type": "text"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Set skip product 5",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "dc877cf2-1493-431c-b5ae-651a8892a9eb",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Has set the property to 5\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.shopgate_settings[0].new).to.eq('5');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_set_settings}}",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][name]",
                  "value": "exclude_item_ids",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][value]",
                  "value": "5",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "5th item is skipped",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3ecc2b48-829f-4e6a-a585-9a41d41ccbbc",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Has 5 items\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(Object.keys(jsonObject.items.item).length).to.eq(5);",
                  "});",
                  "",
                  "pm.test(\"Last item is with UID 6\", function () {",
                  "    body = cheerio(responseBody);",
                  "    uid5 = body.find(\"item[uid='6']\").html();",
                  "    pm.expect(uid5).to.not.eq(null);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "limit",
                  "value": "5",
                  "description": "\n",
                  "type": "text"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Unset skipping 5th product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "b7d95fe6-8a52-4787-8a00-f7ba6772e4b9",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Has unset the property\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.shopgate_settings[0].old[0]).to.eq('5');",
                  "    pm.expect(jsonData.shopgate_settings[0].new).to.eq('');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_set_settings}}",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][name]",
                  "value": "exclude_item_ids",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][value]",
                  "value": "",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "get_items",
      "item": [
        {
          "name": "Configurable Item export",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Configurable product has children\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(jsonObject.items.item.children).to.have.property('item');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "uids[]",
                  "value": "67",
                  "description": "Configurable product",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Grouped Item export",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Grouped product has children\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(jsonObject.items.item).to.have.property('children');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "uids[]",
                  "value": "2046",
                  "description": "Grouped product",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Simple Item export",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Simple product does not have children\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(jsonObject.items.item.children).to.not.have.property('item');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "uids[]",
                  "value": "1",
                  "description": "Simple product",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "first 5 export",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "4f008f6c-31aa-4ea2-8391-5ecd592f4ff2",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Has 5 items\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(Object.keys(jsonObject.items.item).length).to.eq(5);",
                  "});",
                  "",
                  "pm.test(\"Last item is with UID 5\", function () {",
                  "    body = cheerio(responseBody);",
                  "    uid5 = body.find(\"item[uid='5']\").html();",
                  "    pm.expect(uid5).to.not.eq(null);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "limit",
                  "value": "5",
                  "description": "\n",
                  "type": "text"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "item: 5th item is not skipped",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "4f008f6c-31aa-4ea2-8391-5ecd592f4ff2",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Has 5 items\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(Object.keys(jsonObject.items.item).length).to.eq(5);",
                  "});",
                  "",
                  "pm.test(\"Last item is with UID 5\", function () {",
                  "    body = cheerio(responseBody);",
                  "    uid5 = body.find(\"item[uid='5']\").html();",
                  "    pm.expect(uid5).to.not.eq(null);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "limit",
                  "value": "5",
                  "description": "\n",
                  "type": "text"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "check_cart",
      "item": [
        {
          "name": "App coupon",
          "item": [
            {
              "name": "Check_cart iphone",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "6ae1fe12-ef6e-4dd9-a527-5059e749f766",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Cart has coupon\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(1);",
                      "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"APP10\");",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "action",
                      "value": "{{framework_action_check_cart}}",
                      "type": "text"
                    },
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][item_number]",
                      "value": "16",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][internal_order_info]",
                      "value": "{\"product_id\":\"16\",\"item_type\":\"simple\"}\n",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][quantity]",
                      "value": "1",
                      "type": "text"
                    },
                    {
                      "key": "cart[client][type]",
                      "value": "iphoneapp",
                      "type": "text"
                    },
                    {
                      "key": "cart[external_coupons][0][code]",
                      "value": "APP10",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Check_cart android",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "0fb85f58-5331-4851-9de4-e6a70e0308b7",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Cart has coupon\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(1);",
                      "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"APP10\");",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "action",
                      "value": "{{framework_action_check_cart}}",
                      "type": "text"
                    },
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][item_number]",
                      "value": "16",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][internal_order_info]",
                      "value": "{\"product_id\":\"16\",\"item_type\":\"simple\"}\n",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][quantity]",
                      "value": "1",
                      "type": "text"
                    },
                    {
                      "key": "cart[client][type]",
                      "value": "androidphoneapp",
                      "type": "text"
                    },
                    {
                      "key": "cart[external_coupons][0][code]",
                      "value": "APP10",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Check_cart mobile website",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "495094c9-c183-4ff1-a7cd-86181c691127",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"APP10 is an invalid coupon\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(false);",
                      "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"APP10\");",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "action",
                      "value": "{{framework_action_check_cart}}",
                      "type": "text"
                    },
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][item_number]",
                      "value": "16",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][internal_order_info]",
                      "value": "{\"product_id\":\"16\",\"item_type\":\"simple\"}\n",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][quantity]",
                      "value": "1",
                      "type": "text"
                    },
                    {
                      "key": "cart[client][type]",
                      "value": "mobilesite",
                      "type": "text"
                    },
                    {
                      "key": "cart[external_coupons][0][code]",
                      "value": "APP10",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            }
          ],
          "_postman_isSubFolder": true
        },
        {
          "name": "Coupon H20",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "b2d3f67b-a516-4132-92ef-a51f3909138c",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Test that the H20 coupon is valid in cart\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(1);",
                  "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"H20\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "action",
                  "value": "{{framework_action_check_cart}}",
                  "type": "text"
                },
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "cart[customer_number]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[external_customer_id]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[external_customer_group]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[external_customer_group_id]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[mail]",
                  "value": "test@tester.com",
                  "type": "text"
                },
                {
                  "key": "cart[payment_group]",
                  "value": "SHOPGATE",
                  "type": "text"
                },
                {
                  "key": "cart[payment_method]",
                  "value": "SHOPGATE",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][item_id]",
                  "value": "24195039",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][item_number]",
                  "value": "15",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][item_number_public]",
                  "value": "null",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][parent_item_number]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][quantity]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][unit_amount_net]",
                  "value": "2.5",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][unit_amount_with_tax]",
                  "value": "3",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][unit_amount]",
                  "value": "2.5",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][name]",
                  "value": "Luma Bottle",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][tax_percent]",
                  "value": "20",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][tax_class]",
                  "value": "241269",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][currency]",
                  "value": "EUR",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][internal_order_info]",
                  "value": "{\"product_id\":\"15\",\"item_type\":\"simple\"}\n",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][additional_shipping_costs_per_unit]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][is_free_shipping]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][attributes]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][inputs]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][options]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][code]",
                  "value": "TEST_CODE",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][name]",
                  "value": "Coupon Name",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][description]",
                  "value": "Description",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][order_index]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][amount_net]",
                  "value": "10",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][currency]",
                  "value": "USD",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][internal_info]",
                  "value": "{\"coupon_id\":\"1\"}",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][is_free_shipping]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][code]",
                  "value": "TEST_CODE",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][name]",
                  "value": "Coupon Name 2",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][description]",
                  "value": "Description",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][order_index]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][amount_net]",
                  "value": "10",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][currency]",
                  "value": "USD",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][internal_info]",
                  "value": "{\"coupon_id\":\"2\"}",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][is_free_shipping]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][code]",
                  "value": "kittencoupon",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][name]",
                  "value": "Coupon Name 2",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][description]",
                  "value": "Description",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][order_index]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][amount_net]",
                  "value": "15",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][currency]",
                  "value": "USD",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][internal_info]",
                  "value": "{\"coupon_id\":\"3\"}",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][is_free_shipping]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][code]",
                  "value": "H20",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][name]",
                  "value": "Coupon Name",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][description]",
                  "value": "Description",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][order_index]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][amount_net]",
                  "value": "10",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][currency]",
                  "value": "USD",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][internal_info]",
                  "value": "{\"coupon_id\":\"15\"}",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][gender]",
                  "value": "f",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][first_name]",
                  "value": "Krystel",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][last_name]",
                  "value": "Mbarga",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][birthday]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][company]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][street_1]",
                  "value": "7 cours de larche guedon",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][street_2]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][city]",
                  "value": "Torcy",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][zipcode]",
                  "value": "77200",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][country]",
                  "value": "FR",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][state]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][gender]",
                  "value": "f",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][first_name]",
                  "value": "Krystel",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][last_name]",
                  "value": "Mbarga",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][birthday]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][company]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][street_1]",
                  "value": "7 cours de larche guedon",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][street_2]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][city]",
                  "value": "Torcy",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][zipcode]",
                  "value": "77200",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][country]",
                  "value": "FR",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][state]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[internal_cart_info]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[currency]",
                  "value": "EUR",
                  "type": "text"
                },
                {
                  "key": "cart[amount_shipping]",
                  "value": "5",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_group]",
                  "value": "OTHER",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_type]",
                  "value": "PLUGINAPI",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][name]",
                  "value": "socolissimosimplicite_socolissimosimplicite",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][display_name]",
                  "value": "So Colissimo",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][description]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][amount]",
                  "value": "4.16",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][weight]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][internal_shipping_info]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][api_response]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[client][type]",
                  "value": "none",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sales rule subtotal 200+",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "0680eb7e-7084-4196-9f3b-f09f01b1a4f7",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Test that the H20 coupon is valid in cart\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(1);",
                  "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"1\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "action",
                  "value": "{{framework_action_check_cart}}",
                  "type": "text"
                },
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][item_number]",
                  "value": "1266",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][quantity]",
                  "value": "3",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][internal_order_info]",
                  "value": "{\"store_view_id\":\"1\", \"product_id\":\"1266\",\"item_type\":\"simple\", \"exchange_rate\":\"1\"}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            },
            "description": "Adds a sales rule for sub-totals over 200, excludes the sale category items"
          },
          "response": []
        },
        {
          "name": "Invalid Coupon Code",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "dd8d29f1-a6be-4769-a248-3207fe9333b7",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Test that the H20 coupon is valid in cart\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(false);",
                  "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"INACTIVE_CODE\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "action",
                  "value": "{{framework_action_check_cart}}",
                  "type": "text"
                },
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][internal_order_info]",
                  "value": "{\"store_view_id\":\"1\", \"product_id\":\"15\",\"item_type\":\"simple\", \"exchange_rate\":\"1\"}",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][code]",
                  "value": "INACTIVE_CODE",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][internal_info]",
                  "value": "{\"coupon_id\":\"999999\"}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "getOrder",
      "item": [
        {
          "name": "Basic",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "order_numbers[0]",
                  "value": "12345",
                  "type": "text"
                },
                {
                  "key": "with_items",
                  "value": "1",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{mock_url}}/",
              "host": [
                "{{mock_url}}"
              ],
              "path": [
                ""
              ]
            }
          },
          "response": [
            {
              "name": "Basic Qty1",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "order_numbers[0]",
                      "value": "12345",
                      "type": "text"
                    },
                    {
                      "key": "with_items",
                      "value": "1",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{mock_url}}/",
                  "host": [
                    "{{mock_url}}"
                  ],
                  "path": [
                    ""
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json",
                  "name": "Content-Type",
                  "description": "",
                  "type": "text"
                }
              ],
              "cookie": [],
              "body": "{\n    \"orders\": [\n        {\n            \"order_number\": \"{{$randomInt}}{{$randomInt}}\",\n            \"confirm_shipping_url\": \"https://www.shopgate.com/clickcs/1013466122/4e30fb1be239c25f3c75dbe2456dfdbd\",\n            \"created_time\": \"2014-03-20T11:14:03+00:00\",\n            \"is_paid\": 0,\n            \"payment_time\": null,\n            \"payment_transaction_number\": null,\n            \"payment_infos\": {\n                \"shopgate_payment_name\": \"Vorkasse (Eigene Abwicklung)\",\n                \"purpose\": \"SG1501511499\"\n            },\n            \"is_shipping_blocked\": 0,\n            \"is_shipping_completed\": 1,\n            \"shipping_completed_time\": \"2014-08-06T11:57:29+00:00\",\n            \"is_test\": 0,\n            \"is_storno\": 0,\n            \"is_customer_invoice_blocked\": \"0\",\n            \"update_shipping\": false,\n            \"update_payment\": false,\n            \"delivery_notes\": null,\n            \"customer_number\": \"2059691\",\n            \"external_order_number\": null,\n            \"external_order_id\": \"8240\",\n            \"external_customer_number\": null,\n            \"external_customer_id\": null,\n            \"mail\": \"konstantin.test1@shopgate.com\",\n            \"phone\": null,\n            \"mobile\": null,\n            \"shipping_group\": \"DHL\",\n            \"shipping_type\": \"MANUAL\",\n            \"shipping_infos\": {\n                \"name\": \"DHL Deutschland\",\n                \"display_name\": \"DHL Pakte gogreen\",\n                \"description\": \"\",\n                \"amount\": \"4.90\",\n                \"weight\": 0,\n                \"api_response\": null\n            },\n            \"custom_fields\": [\n                {\n                    \"label\": \"Test Custom Field\",\n                    \"internal_field_name\": \"test_field\",\n                    \"value\": \"test field value\"\n                }\n            ],\n            \"payment_method\": \"PREPAY\",\n            \"payment_group\": \"PREPAY\",\n            \"amount_items\": \"139.95\",\n            \"amount_shipping\": \"4.90\",\n            \"amount_shop_payment\": \"5.00\",\n            \"payment_tax_percent\": \"19.00\",\n            \"amount_shopgate_payment\": \"0.00\",\n            \"amount_complete\": \"149.85\",\n            \"currency\": \"EUR\",\n            \"invoice_address\": {\n                \"id\": null,\n                \"is_invoice_address\": true,\n                \"is_delivery_address\": false,\n                \"first_name\": \"Bank\",\n                \"last_name\": \"Payment\",\n                \"gender\": \"f\",\n                \"birthday\": null,\n                \"company\": null,\n                \"street_1\": \"Zevener Strae 8\",\n                \"street_2\": null,\n                \"zipcode\": \"27404\",\n                \"city\": \"Frankenbostel\",\n                \"country\": \"DE\",\n                \"state\": null,\n                \"phone\": null,\n                \"mobile\": null,\n                \"mail\": null,\n                \"custom_fields\": [\n                    {\n                        \"label\": \"Is house?\",\n                        \"internal_field_name\": \"is_house\",\n                        \"value\": 0\n                    }\n                ]\n            },\n            \"delivery_address\": {\n                \"id\": null,\n                \"is_invoice_address\": false,\n                \"is_delivery_address\": true,\n                \"first_name\": \"Bank\",\n                \"last_name\": \"Payment\",\n                \"gender\": \"f\",\n                \"birthday\": null,\n                \"company\": null,\n                \"street_1\": \"Zevener Strae 8\",\n                \"street_2\": null,\n                \"zipcode\": \"27404\",\n                \"city\": \"Frankenbostel\",\n                \"country\": \"DE\",\n                \"state\": null,\n                \"phone\": null,\n                \"mobile\": null,\n                \"mail\": null,\n                \"custom_fields\": [\n                    {\n                        \"label\": \"Is house?\",\n                        \"internal_field_name\": \"is_house\",\n                        \"value\": 1\n                    }\n                ]\n            },\n            \"external_coupons\": [],\n            \"shopgate_coupons\": [],\n            \"items\": [\n                {\n                    \"item_number\": \"36\",\n                    \"item_number_public\": \"36\",\n                    \"parent_item_number\": null,\n                    \"order_item_id\": \"4399298\",\n                    \"quantity\": 2,\n                    \"name\": \"Aim Analog Watch\",\n                    \"unit_amount\": \"45.00\",\n                    \"unit_amount_with_tax\": \"45.00\",\n                    \"tax_percent\": \"19.00\",\n                    \"tax_class_key\": null,\n                    \"tax_class_id\": null,\n                    \"currency\": \"USD\",\n                    \"internal_order_info\": \"{\\\"product_id\\\":\\\"36\\\", \\\"item_type\\\": \\\"simple\\\"}\",\n                    \"options\": [],\n                    \"inputs\": [],\n                    \"attributes\": []\n                }\n            ]\n        }\n    ]\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "cron",
      "item": [
        {
          "name": "Shipping",
          "item": [
            {
              "name": "addOrder",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "a2082153-dc71-49bf-8374-976a9fa4075f",
                    "type": "text/javascript",
                    "exec": [
                      "var jsonData = pm.response.json();",
                      "",
                      "pm.test(\"Order added properly\", function () {",
                      "    pm.expect(jsonData).to.have.property('external_order_id');",
                      "});",
                      "",
                      "if ('external_order_id' in jsonData) {",
                      "    pm.environment.set(\"order_id\", jsonData.external_order_id);",
                      "}",
                      ""
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_add_order}}",
                      "type": "text"
                    },
                    {
                      "key": "order_number",
                      "value": "12345",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "get mage order item id",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "7838a4df-c9d7-47c4-95c9-358a162fbc69",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "if (jsonData.hasOwnProperty('items') && jsonData.items.length > 0) {",
                      "    pm.environment.set(\"order_item_id\", jsonData.items[0].item_id);",
                      "}",
                      ""
                    ]
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "id": "f60b1063-bfef-4783-baa6-5748820c113e",
                    "type": "text/javascript",
                    "exec": [
                      "// Retrieve magento 2 API key",
                      "const key = pm.environment.get(\"m2_api_key\")",
                      "if (!key) {",
                      "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
                      "    const postRequest = {",
                      "      url: url,",
                      "      method: 'POST',",
                      "      header: 'Content-Type:application/json',",
                      "      body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "        \t\"username\": pm.environment.get(\"admin_user\"),",
                      "        \t\"password\": pm.environment.get(\"admin_pass\")",
                      "        })",
                      "      }",
                      "    };",
                      "   pm.sendRequest(postRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.log(err);",
                      "    } else {",
                      "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
                      "    }",
                      "}); ",
                      "}"
                    ]
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{m2_api_key}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest}}/V1/orders/{{order_id}}",
                  "host": [
                    "{{m2_rest}}"
                  ],
                  "path": [
                    "V1",
                    "orders",
                    "{{order_id}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "ship order partially",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "f3b6849c-b508-4552-af2e-5ed3ce9adc4f",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "if (pm.response.status === 200) {",
                      "  pm.environment.set(\"shipment_id\", response.text().replace(/['\"]+/g, ''));   ",
                      "}",
                      ""
                    ]
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "id": "fd4f3f98-3e8e-4693-9983-061c1c1fa6d2",
                    "type": "text/javascript",
                    "exec": [
                      "// Retrieve magento 2 API key",
                      "const key = pm.environment.get(\"m2_api_key\")",
                      "if (!key) {",
                      "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
                      "    const postRequest = {",
                      "      url: url,",
                      "      method: 'POST',",
                      "      header: 'Content-Type:application/json',",
                      "      body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "        \t\"username\": pm.environment.get(\"admin_user\"),",
                      "        \t\"password\": pm.environment.get(\"admin_pass\")",
                      "        })",
                      "      }",
                      "    };",
                      "   pm.sendRequest(postRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.log(err);",
                      "    } else {",
                      "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
                      "    }",
                      "}); ",
                      "}"
                    ]
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{m2_api_key}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"items\": [\n    {\n      \"order_item_id\": \"{{order_item_id}}\",\n      \"qty\": 1\n    }\n  ],\n  \"tracks\": [\n    {\n      \"track_number\": \"1Y-9876543210\",\n      \"title\": \"United Parcel Service\",\n      \"carrier_code\": \"ups\"\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{m2_rest}}/V1/order/{{order_id}}/ship",
                  "host": [
                    "{{m2_rest}}"
                  ],
                  "path": [
                    "V1",
                    "order",
                    "{{order_id}}",
                    "ship"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "cron: ship",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "9236e0cf-c01a-4440-b76f-55e03e543675",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_cron}}",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_name]",
                      "value": "set_shipping_completed",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_params]",
                      "value": "0",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "get SG order",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "3b065b99-db9c-4868-b227-db87efa0c70e",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "pm.test(\"Shipment is present\", function () {",
                      "    pm.expect(jsonData.reported_shipping_collections.length).to.eql(1);",
                      "});",
                      "",
                      "pm.test(\"Is not sent to shopgate as the order is not fulfilled\", function () {",
                      "    pm.expect(jsonData.is_sent_to_shopgate).to.eql(0);",
                      "});"
                    ]
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "id": "5ce2cda9-7368-41fa-94f2-8d0a50687f93",
                    "type": "text/javascript",
                    "exec": [
                      "// Retrieve magento 2 API key",
                      "const key = pm.environment.get(\"m2_api_key\")",
                      "if (!key) {",
                      "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
                      "    const postRequest = {",
                      "      url: url,",
                      "      method: 'POST',",
                      "      header: 'Content-Type:application/json',",
                      "      body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "        \t\"username\": pm.environment.get(\"admin_user\"),",
                      "        \t\"password\": pm.environment.get(\"admin_pass\")",
                      "        })",
                      "      }",
                      "    };",
                      "   pm.sendRequest(postRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.log(err);",
                      "    } else {",
                      "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
                      "    }",
                      "}); ",
                      "}",
                      "",
                      "",
                      "",
                      "",
                      ""
                    ]
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{m2_api_key}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest}}/V1/shopgate/order/mage/{{order_id}}",
                  "host": [
                    "{{m2_rest}}"
                  ],
                  "path": [
                    "V1",
                    "shopgate",
                    "order",
                    "mage",
                    "{{order_id}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "ship order completely",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "f3b6849c-b508-4552-af2e-5ed3ce9adc4f",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "if (pm.response.status === 200) {",
                      "  pm.environment.set(\"shipment_id\", response.text().replace(/['\"]+/g, ''));   ",
                      "}",
                      ""
                    ]
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "id": "fd4f3f98-3e8e-4693-9983-061c1c1fa6d2",
                    "type": "text/javascript",
                    "exec": [
                      "// Retrieve magento 2 API key",
                      "const key = pm.environment.get(\"m2_api_key\")",
                      "if (!key) {",
                      "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
                      "    const postRequest = {",
                      "      url: url,",
                      "      method: 'POST',",
                      "      header: 'Content-Type:application/json',",
                      "      body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "        \t\"username\": pm.environment.get(\"admin_user\"),",
                      "        \t\"password\": pm.environment.get(\"admin_pass\")",
                      "        })",
                      "      }",
                      "    };",
                      "   pm.sendRequest(postRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.log(err);",
                      "    } else {",
                      "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
                      "    }",
                      "}); ",
                      "}"
                    ]
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{m2_api_key}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"items\": [\n    {\n      \"order_item_id\": \"{{order_item_id}}\",\n      \"qty\": 1\n    }\n  ],\n  \"tracks\": [\n    {\n      \"track_number\": \"1Y-9876543210\",\n      \"title\": \"United Parcel Service\",\n      \"carrier_code\": \"ups\"\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{m2_rest}}/V1/order/{{order_id}}/ship",
                  "host": [
                    "{{m2_rest}}"
                  ],
                  "path": [
                    "V1",
                    "order",
                    "{{order_id}}",
                    "ship"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "cron: ship",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "639381c5-dba8-4982-969b-2cb5c9d31d37",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_cron}}",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_name]",
                      "value": "set_shipping_completed",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_params]",
                      "value": "0",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "is SG order sent?",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "c4be19ff-8997-4e49-ab26-363888968753",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "pm.test(\"2 shipments are present\", function () {",
                      "    pm.expect(jsonData.reported_shipping_collections.length).to.eql(2);",
                      "});",
                      "",
                      "pm.test(\"Is sent to shopgate as the order is fulfilled\", function () {",
                      "    pm.expect(jsonData.is_sent_to_shopgate).to.eql(1);",
                      "});"
                    ]
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "id": "5ce2cda9-7368-41fa-94f2-8d0a50687f93",
                    "type": "text/javascript",
                    "exec": [
                      "// Retrieve magento 2 API key",
                      "const key = pm.environment.get(\"m2_api_key\")",
                      "if (!key) {",
                      "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
                      "    const postRequest = {",
                      "      url: url,",
                      "      method: 'POST',",
                      "      header: 'Content-Type:application/json',",
                      "      body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "        \t\"username\": pm.environment.get(\"admin_user\"),",
                      "        \t\"password\": pm.environment.get(\"admin_pass\")",
                      "        })",
                      "      }",
                      "    };",
                      "   pm.sendRequest(postRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.log(err);",
                      "    } else {",
                      "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
                      "    }",
                      "}); ",
                      "}",
                      "",
                      "",
                      "",
                      "",
                      ""
                    ]
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{m2_api_key}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest}}/V1/shopgate/order/mage/{{order_id}}",
                  "host": [
                    "{{m2_rest}}"
                  ],
                  "path": [
                    "V1",
                    "shopgate",
                    "order",
                    "mage",
                    "{{order_id}}"
                  ]
                }
              },
              "response": []
            }
          ],
          "description": "Tests shipping cron. Ships 1 item at first, then checks that the is_sent is not set so that it can send the order to shopgate when it is fully shipped.",
          "_postman_isSubFolder": true
        },
        {
          "name": "Cancel Orders",
          "item": [
            {
              "name": "addOrder",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "a2082153-dc71-49bf-8374-976a9fa4075f",
                    "type": "text/javascript",
                    "exec": [
                      "var jsonData = pm.response.json();",
                      "",
                      "pm.test(\"Order added properly\", function () {",
                      "    pm.expect(jsonData).to.have.property('external_order_id');",
                      "});",
                      "",
                      "if ('external_order_id' in jsonData) {",
                      "    pm.environment.set(\"order_id\", jsonData.external_order_id);",
                      "}",
                      ""
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_add_order}}",
                      "type": "text"
                    },
                    {
                      "key": "order_number",
                      "value": "12345",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "M2: get SG order",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "e1a94097-2d62-4940-89d3-6baafa3ca988",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "pm.test(\"Cancellation is not sent to shopgate\", function () {",
                      "    pm.expect(jsonData.is_cancellation_sent_to_shopgate).to.eql(0);",
                      "});"
                    ]
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "id": "5ce2cda9-7368-41fa-94f2-8d0a50687f93",
                    "type": "text/javascript",
                    "exec": [
                      "// Retrieve magento 2 API key",
                      "const key = pm.environment.get(\"m2_api_key\")",
                      "if (!key) {",
                      "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
                      "    const postRequest = {",
                      "      url: url,",
                      "      method: 'POST',",
                      "      header: 'Content-Type:application/json',",
                      "      body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "        \t\"username\": pm.environment.get(\"admin_user\"),",
                      "        \t\"password\": pm.environment.get(\"admin_pass\")",
                      "        })",
                      "      }",
                      "    };",
                      "   pm.sendRequest(postRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.log(err);",
                      "    } else {",
                      "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
                      "    }",
                      "}); ",
                      "}",
                      "",
                      "",
                      "",
                      "",
                      ""
                    ]
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{m2_api_key}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest}}/V1/shopgate/order/mage/{{order_id}}",
                  "host": [
                    "{{m2_rest}}"
                  ],
                  "path": [
                    "V1",
                    "shopgate",
                    "order",
                    "mage",
                    "{{order_id}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "M2: cancel order",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "7cea8fa0-9a0d-42b3-a9a1-f5c1b201e6a2",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      ""
                    ]
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "id": "fd4f3f98-3e8e-4693-9983-061c1c1fa6d2",
                    "type": "text/javascript",
                    "exec": [
                      "// Retrieve magento 2 API key",
                      "const key = pm.environment.get(\"m2_api_key\")",
                      "if (!key) {",
                      "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
                      "    const postRequest = {",
                      "      url: url,",
                      "      method: 'POST',",
                      "      header: 'Content-Type:application/json',",
                      "      body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "        \t\"username\": pm.environment.get(\"admin_user\"),",
                      "        \t\"password\": pm.environment.get(\"admin_pass\")",
                      "        })",
                      "      }",
                      "    };",
                      "   pm.sendRequest(postRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.log(err);",
                      "    } else {",
                      "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
                      "    }",
                      "}); ",
                      "}"
                    ]
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{m2_api_key}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"items\": [\n    {\n      \"order_item_id\": \"{{order_item_id}}\",\n      \"qty\": 1\n    }\n  ],\n  \"tracks\": [\n    {\n      \"track_number\": \"1Y-9876543210\",\n      \"title\": \"United Parcel Service\",\n      \"carrier_code\": \"ups\"\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{m2_rest}}/V1/orders/{{order_id}}/cancel",
                  "host": [
                    "{{m2_rest}}"
                  ],
                  "path": [
                    "V1",
                    "orders",
                    "{{order_id}}",
                    "cancel"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "cron: cancel_orders",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "9236e0cf-c01a-4440-b76f-55e03e543675",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_cron}}",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_name]",
                      "value": "cancel_orders",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_params]",
                      "value": "0",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "is SG order sent?",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "7b143182-78ea-4078-89d5-fc6b6ab863f1",
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "pm.test(\"Cancellation is sent to shopgate\", function () {",
                      "    pm.expect(jsonData.is_cancellation_sent_to_shopgate).to.eql(1);",
                      "});",
                      "",
                      "pm.test(\"No shipments are done\", function () {",
                      "    pm.expect(jsonData.reported_shipping_collections.length).to.eql(0);",
                      "});",
                      "",
                      "pm.test(\"Shipping is not sent to shopgate\", function () {",
                      "    pm.expect(jsonData.is_sent_to_shopgate).to.eql(0);",
                      "});"
                    ]
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "id": "5ce2cda9-7368-41fa-94f2-8d0a50687f93",
                    "type": "text/javascript",
                    "exec": [
                      "// Retrieve magento 2 API key",
                      "const key = pm.environment.get(\"m2_api_key\")",
                      "if (!key) {",
                      "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
                      "    const postRequest = {",
                      "      url: url,",
                      "      method: 'POST',",
                      "      header: 'Content-Type:application/json',",
                      "      body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "        \t\"username\": pm.environment.get(\"admin_user\"),",
                      "        \t\"password\": pm.environment.get(\"admin_pass\")",
                      "        })",
                      "      }",
                      "    };",
                      "   pm.sendRequest(postRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.log(err);",
                      "    } else {",
                      "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
                      "    }",
                      "}); ",
                      "}",
                      "",
                      "",
                      "",
                      "",
                      ""
                    ]
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{m2_api_key}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest}}/V1/shopgate/order/mage/{{order_id}}",
                  "host": [
                    "{{m2_rest}}"
                  ],
                  "path": [
                    "V1",
                    "shopgate",
                    "order",
                    "mage",
                    "{{order_id}}"
                  ]
                }
              },
              "response": []
            }
          ],
          "description": "Tests shipping cron. Ships 1 item at first, then checks that the is_sent is not set so that it can send the order to shopgate when it is fully shipped.",
          "_postman_isSubFolder": true
        }
      ]
    },
    {
      "name": "get_settings",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "dc877cf2-1493-431c-b5ae-651a8892a9eb",
            "exec": [
              "pm.test('Test payload with correct data returned', function() {",
              "    const jsonData = pm.response.json();",
              "    const taxRate = jsonData.tax.tax_rates.pop();",
              "    pm.expect(taxRate.state).to.eq('US-MI');",
              "    pm.expect(taxRate.tax_percent).to.eq(8.25);",
              "    const customerGroup = jsonData.customer_groups.pop();",
              "    pm.expect(customerGroup.name).to.eq('Retailer');",
              "    pm.expect(customerGroup.customer_tax_class_key).to.eq('Retail Customer');",
              "    pm.expect(jsonData.allowed_address_countries.length).to.be.gt(0);",
              "    pm.expect(jsonData.allowed_shipping_countries.length).to.be.gt(0);",
              "    pm.expect(jsonData.payment_methods.length).to.be.eq(3);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_get_settings}}",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "ping",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "471b0ed3-c085-43e9-87a7-b27b0834fb6f",
            "type": "text/javascript",
            "exec": [
              "var jsonData = pm.response.json();",
              "pm.test(\"Ping Pong\", function () {",
              "    pm.expect(jsonData.pong).to.eql('OK');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Accept",
            "value": "*/*"
          },
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_ping}}",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "getReviews",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "f7a47943-ee89-4432-b552-f551ed60f8e4",
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Not an error\", function () {",
              "    pm.response.to.not.have.jsonBody('error');",
              "});",
              "",
              "pm.test(\"have reviews\", function () {",
              "    var jsonObject = xml2Json(responseBody);",
              "    pm.expect(jsonObject.reviews.review).to.have.property('item_uid');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Accept",
            "value": "*/*"
          },
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_get_reviews}}",
              "type": "text"
            },
            {
              "key": "limit",
              "value": "1",
              "type": "text"
            },
            {
              "key": "offset",
              "value": "1",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "get_customer",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "471b0ed3-c085-43e9-87a7-b27b0834fb6f",
            "exec": [
              "const jsonData = pm.response.json();",
              "pm.test(\"Check customer data\", function () {",
              "    pm.expect(jsonData.user_data.gender).to.eql('f');",
              "    pm.expect(jsonData.user_data.birthday).to.eql('1973-12-15');",
              "    const address = jsonData.addresses.pop();",
              "    pm.expect(address.country).to.eql('US');",
              "    pm.expect(address.state).to.eql('US-MI');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Accept",
            "value": "*/*"
          },
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_get_customer}}",
              "type": "text"
            },
            {
              "key": "user",
              "value": "roni_cost@example.com",
              "type": "text"
            },
            {
              "key": "pass",
              "value": "roni_cost3@example.com",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "getCategories",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "b932f643-873e-4485-91be-5c98a5f3269e",
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Not an error\", function () {",
              "    pm.response.to.not.have.jsonBody('error');",
              "});",
              "",
              "pm.test(\"have categories\", function () {",
              "    var jsonObject = xml2Json(responseBody);",
              "    pm.expect(jsonObject.categories.category).to.have.property('name');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Accept",
            "value": "*/*"
          },
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_get_categories}}",
              "type": "text"
            },
            {
              "key": "limit",
              "value": "1",
              "type": "text"
            },
            {
              "key": "offset",
              "value": "1",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "get SG order",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "0b446693-0729-4bc0-9f7b-4e2928ba6a4f",
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "var jsonData = pm.response.json();",
              "if (jsonData.hasOwnProperty('items') && jsonData.items.length > 0) {",
              "    pm.environment.set(\"order_item_id\", jsonData.items[0].item_id);",
              "}"
            ]
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "id": "5ce2cda9-7368-41fa-94f2-8d0a50687f93",
            "type": "text/javascript",
            "exec": [
              "// Retrieve magento 2 API key",
              "const key = pm.environment.get(\"m2_api_key\")",
              "if (!key) {",
              "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
              "    const postRequest = {",
              "      url: url,",
              "      method: 'POST',",
              "      header: 'Content-Type:application/json',",
              "      body: {",
              "        mode: 'raw',",
              "        raw: JSON.stringify({",
              "        \t\"username\": pm.environment.get(\"admin_user\"),",
              "        \t\"password\": pm.environment.get(\"admin_pass\")",
              "        })",
              "      }",
              "    };",
              "   pm.sendRequest(postRequest, function (err, response) {",
              "    if (err) {",
              "        console.log(err);",
              "    } else {",
              "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
              "    }",
              "}); ",
              "}",
              "",
              "",
              "",
              "",
              ""
            ]
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{m2_api_key}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{m2_rest}}/V1/shopgate/order/{{shopgate_order_id}}",
          "host": [
            "{{m2_rest}}"
          ],
          "path": [
            "V1",
            "shopgate",
            "order",
            "{{shopgate_order_id}}"
          ]
        }
      },
      "response": []
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "id": "8ed06374-7b4d-43c8-b835-d016bfc10f5f",
        "type": "text/javascript",
        "exec": [
          "var tstamp = Math.floor(Date.now() / 1000);",
          "",
          "// Use the CryptoJS",
          "var authUser = pm.environment.get('customer_number') + \"-\" + tstamp;",
          "var tokenData = \"SPA-\" + pm.environment.get('customer_number') + \"-\" + tstamp + \"-\" + pm.environment.get('api_key');",
          "",
          "var authToken = CryptoJS.SHA1(tokenData).toString();",
          "",
          "// Set the new header values",
          "pm.environment.set(\"sgHeaderAuthUser\", authUser);",
          "pm.environment.set(\"sgHeaderAuthToken\", authToken);"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "id": "508f298f-9c6b-4a5e-827d-1be4e59e173b",
        "type": "text/javascript",
        "exec": [
          "// remove key if it is invalid",
          "if (pm.response.code === 401) {",
          "    pm.environment.unset(\"m2_api_key\");",
          "}"
        ]
      }
    }
  ]
}
