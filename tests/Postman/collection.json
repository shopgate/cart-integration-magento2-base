{
  "info": {
    "_postman_id": "8d3ddb8c-c20b-4f73-aad6-4bf4af8d2ae2",
    "name": "Mage2",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "5289226"
  },
  "item": [
    {
      "name": "init",
      "item": [
        {
          "name": "M2A: get token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {\r",
                  "    pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "pm.test(\"Body is a string\", function () {\r",
                  "    const token = pm.response.text().replace(/['\"]+/g, '');\r",
                  "    pm.expect(token).to.be.a('string');\r",
                  "    pm.environment.set('gen_adminToken', token);\r",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"username\": \"{{admin_user}}\",\r\n  \"password\": \"{{admin_pass}}\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{m2_endpoint_admin_token}}",
              "host": [
                "{{m2_endpoint_admin_token}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "M2A: get config prod",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {\r",
                  "    pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "pm.test(\"get product id\", function () {\r",
                  "    var jsonData = pm.response.json();\r",
                  "    pm.expect(jsonData.id).to.be.a('number');\r",
                  "    pm.environment.set('gen_config_prod1_id', jsonData.id);\r",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{gen_adminToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{m2_rest_default}}/V1/products/:sku",
              "host": [
                "{{m2_rest_default}}"
              ],
              "path": [
                "V1",
                "products",
                ":sku"
              ],
              "variable": [
                {
                  "key": "sku",
                  "value": "MH01"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "M2A: get simple prod",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {\r",
                  "    pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "pm.test(\"get product id\", function () {\r",
                  "    var jsonData = pm.response.json();\r",
                  "    pm.expect(jsonData.id).to.be.a('number');\r",
                  "    pm.environment.set('gen_simple_prod1_id', jsonData.id);\r",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{gen_adminToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{m2_rest_default}}/V1/products/:sku",
              "host": [
                "{{m2_rest_default}}"
              ],
              "path": [
                "V1",
                "products",
                ":sku"
              ],
              "variable": [
                {
                  "key": "sku",
                  "value": "24-UB02",
                  "description": "Impulse Duffle"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "M2A: get group prod",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {\r",
                  "    pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "pm.test(\"get product id\", function () {\r",
                  "    var jsonData = pm.response.json();\r",
                  "    pm.expect(jsonData.id).to.be.a('number');\r",
                  "    pm.environment.set('gen_group_prod1_id', jsonData.id);\r",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{gen_adminToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{m2_rest_default}}/V1/products/:sku",
              "host": [
                "{{m2_rest_default}}"
              ],
              "path": [
                "V1",
                "products",
                ":sku"
              ],
              "variable": [
                {
                  "key": "sku",
                  "value": "24-WG085_Group"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "M2A: get bundle prod",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {\r",
                  "    pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "pm.test(\"get product id\", function () {\r",
                  "    var jsonData = pm.response.json();\r",
                  "    pm.expect(jsonData.id).to.be.a('number');\r",
                  "    pm.environment.set('gen_bundle_prod1_id', jsonData.id);\r",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{gen_adminToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{m2_rest_default}}/V1/products/:sku",
              "host": [
                "{{m2_rest_default}}"
              ],
              "path": [
                "V1",
                "products",
                ":sku"
              ],
              "variable": [
                {
                  "key": "sku",
                  "value": "24-WG080"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "SG: set mock api url",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_set_settings}}",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][name]",
                  "value": "server",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][value]",
                  "value": "custom",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[1][name]",
                  "value": "api_url",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[1][value]",
                  "value": "{{mock_server_merchant_uri}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "set_settings",
      "item": [
        {
          "name": "5th item is not skipped",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Has 5 items\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(Object.keys(jsonObject.items.item).length).to.eq(5);",
                  "});",
                  "",
                  "pm.test(\"Last item is with UID 5\", function () {",
                  "    body = cheerio(responseBody);",
                  "    uid5 = body.find(\"item[uid='5']\").html();",
                  "    pm.expect(uid5).to.not.eq(null);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "limit",
                  "value": "5",
                  "description": "\n",
                  "type": "text"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Set skip product 5",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Has set the property to 5\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.shopgate_settings[0].new).to.eq('5');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_set_settings}}",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][name]",
                  "value": "exclude_item_ids",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][value]",
                  "value": "5",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "5th item is skipped",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Has 5 items\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(Object.keys(jsonObject.items.item).length).to.eq(5);",
                  "});",
                  "",
                  "pm.test(\"Last item is with UID 6\", function () {",
                  "    body = cheerio(responseBody);",
                  "    uid5 = body.find(\"item[uid='6']\").html();",
                  "    pm.expect(uid5).to.not.eq(null);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "limit",
                  "value": "5",
                  "description": "\n",
                  "type": "text"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Unset skipping 5th product",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Has unset the property\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.shopgate_settings[0].old[0]).to.eq('5');",
                  "    pm.expect(jsonData.shopgate_settings[0].new).to.eq('');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_set_settings}}",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][name]",
                  "value": "exclude_item_ids",
                  "type": "text"
                },
                {
                  "key": "shopgate_settings[0][value]",
                  "value": "",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "get_items",
      "item": [
        {
          "name": "Configurable Item export",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Configurable product has children\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(jsonObject.items.item.children).to.have.property('item');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "uids[]",
                  "value": "{{gen_config_prod1_id}}",
                  "description": "Configurable product",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Grouped Item export",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Grouped product has children\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(jsonObject.items.item).to.have.property('children');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "uids[]",
                  "value": "{{gen_group_prod1_id}}",
                  "description": "Grouped product",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Simple Item export",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Simple product does not have children\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(jsonObject.items.item.children).to.not.have.property('item');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "uids[]",
                  "value": "{{gen_simple_prod1_id}}",
                  "description": "Simple product",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "first 5 export",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Has 5 items\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(Object.keys(jsonObject.items.item).length).to.eq(5);",
                  "});",
                  "",
                  "pm.test(\"Last item is with UID 5\", function () {",
                  "    body = cheerio(responseBody);",
                  "    uid5 = body.find(\"item[uid='5']\").html();",
                  "    pm.expect(uid5).to.not.eq(null);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "limit",
                  "value": "5",
                  "description": "\n",
                  "type": "text"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "item: 5th item is not skipped",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Not an error\", function () {",
                  "    pm.response.to.not.have.jsonBody('error');",
                  "});",
                  "",
                  "pm.test(\"Has 5 items\", function () {",
                  "    var jsonObject = xml2Json(responseBody);",
                  "    pm.expect(Object.keys(jsonObject.items.item).length).to.eq(5);",
                  "});",
                  "",
                  "pm.test(\"Last item is with UID 5\", function () {",
                  "    body = cheerio(responseBody);",
                  "    uid5 = body.find(\"item[uid='5']\").html();",
                  "    pm.expect(uid5).to.not.eq(null);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_get_items}}",
                  "type": "text"
                },
                {
                  "key": "limit",
                  "value": "5",
                  "description": "\n",
                  "type": "text"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "check_cart",
      "item": [
        {
          "name": "App coupon",
          "item": [
            {
              "name": "Check_cart iphone",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Cart has coupon\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(1);",
                      "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"APP10\");",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "action",
                      "value": "{{framework_action_check_cart}}",
                      "type": "text"
                    },
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][item_number]",
                      "value": "16",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][internal_order_info]",
                      "value": "{\"product_id\":\"16\",\"item_type\":\"simple\"}\n",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][quantity]",
                      "value": "1",
                      "type": "text"
                    },
                    {
                      "key": "cart[client][type]",
                      "value": "iphoneapp",
                      "type": "text"
                    },
                    {
                      "key": "cart[external_coupons][0][code]",
                      "value": "APP10",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Check_cart android",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Cart has coupon\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(1);",
                      "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"APP10\");",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "action",
                      "value": "{{framework_action_check_cart}}",
                      "type": "text"
                    },
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][item_number]",
                      "value": "16",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][internal_order_info]",
                      "value": "{\"product_id\":\"16\",\"item_type\":\"simple\"}\n",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][quantity]",
                      "value": "1",
                      "type": "text"
                    },
                    {
                      "key": "cart[client][type]",
                      "value": "androidphoneapp",
                      "type": "text"
                    },
                    {
                      "key": "cart[external_coupons][0][code]",
                      "value": "APP10",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Check_cart mobile website",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"APP10 is an invalid coupon\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(false);",
                      "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"APP10\");",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "action",
                      "value": "{{framework_action_check_cart}}",
                      "type": "text"
                    },
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][item_number]",
                      "value": "16",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][internal_order_info]",
                      "value": "{\"product_id\":\"16\",\"item_type\":\"simple\"}\n",
                      "type": "text"
                    },
                    {
                      "key": "cart[items][0][quantity]",
                      "value": "1",
                      "type": "text"
                    },
                    {
                      "key": "cart[client][type]",
                      "value": "mobilesite",
                      "type": "text"
                    },
                    {
                      "key": "cart[external_coupons][0][code]",
                      "value": "APP10",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            }
          ]
        },
        {
          "name": "Coupon H20",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Test that the H20 coupon is valid in cart\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(1);",
                  "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"H20\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "action",
                  "value": "{{framework_action_check_cart}}",
                  "type": "text"
                },
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "cart[customer_number]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[external_customer_id]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[external_customer_group]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[external_customer_group_id]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[mail]",
                  "value": "test@tester.com",
                  "type": "text"
                },
                {
                  "key": "cart[payment_group]",
                  "value": "SHOPGATE",
                  "type": "text"
                },
                {
                  "key": "cart[payment_method]",
                  "value": "SHOPGATE",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][item_id]",
                  "value": "24195039",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][item_number]",
                  "value": "15",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][item_number_public]",
                  "value": "null",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][parent_item_number]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][quantity]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][unit_amount_net]",
                  "value": "2.5",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][unit_amount_with_tax]",
                  "value": "3",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][unit_amount]",
                  "value": "2.5",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][name]",
                  "value": "Luma Bottle",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][tax_percent]",
                  "value": "20",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][tax_class]",
                  "value": "241269",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][currency]",
                  "value": "EUR",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][internal_order_info]",
                  "value": "{\"product_id\":\"15\",\"item_type\":\"simple\"}\n",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][additional_shipping_costs_per_unit]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][is_free_shipping]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][attributes]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][inputs]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][options]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][code]",
                  "value": "TEST_CODE",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][name]",
                  "value": "Coupon Name",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][description]",
                  "value": "Description",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][order_index]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][amount_net]",
                  "value": "10",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][currency]",
                  "value": "USD",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][internal_info]",
                  "value": "{\"coupon_id\":\"1\"}",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][0][is_free_shipping]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][code]",
                  "value": "TEST_CODE",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][name]",
                  "value": "Coupon Name 2",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][description]",
                  "value": "Description",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][order_index]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][amount_net]",
                  "value": "10",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][currency]",
                  "value": "USD",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][internal_info]",
                  "value": "{\"coupon_id\":\"2\"}",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][1][is_free_shipping]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][code]",
                  "value": "kittencoupon",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][name]",
                  "value": "Coupon Name 2",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][description]",
                  "value": "Description",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][order_index]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][amount_net]",
                  "value": "15",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][currency]",
                  "value": "USD",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][internal_info]",
                  "value": "{\"coupon_id\":\"3\"}",
                  "type": "text"
                },
                {
                  "key": "cart[shopgate_coupons][2][is_free_shipping]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][code]",
                  "value": "H20",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][name]",
                  "value": "Coupon Name",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][description]",
                  "value": "Description",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][order_index]",
                  "value": "1",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][amount_net]",
                  "value": "10",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][currency]",
                  "value": "USD",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][internal_info]",
                  "value": "{\"coupon_id\":\"15\"}",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][gender]",
                  "value": "f",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][first_name]",
                  "value": "Krystel",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][last_name]",
                  "value": "Mbarga",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][birthday]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][company]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][street_1]",
                  "value": "7 cours de larche guedon",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][street_2]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][city]",
                  "value": "Torcy",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][zipcode]",
                  "value": "77200",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][country]",
                  "value": "FR",
                  "type": "text"
                },
                {
                  "key": "cart[invoice_address][state]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][gender]",
                  "value": "f",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][first_name]",
                  "value": "Krystel",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][last_name]",
                  "value": "Mbarga",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][birthday]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][company]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][street_1]",
                  "value": "7 cours de larche guedon",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][street_2]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][city]",
                  "value": "Torcy",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][zipcode]",
                  "value": "77200",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][country]",
                  "value": "FR",
                  "type": "text"
                },
                {
                  "key": "cart[delivery_address][state]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[internal_cart_info]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[currency]",
                  "value": "EUR",
                  "type": "text"
                },
                {
                  "key": "cart[amount_shipping]",
                  "value": "5",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_group]",
                  "value": "OTHER",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_type]",
                  "value": "PLUGINAPI",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][name]",
                  "value": "socolissimosimplicite_socolissimosimplicite",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][display_name]",
                  "value": "So Colissimo",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][description]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][amount]",
                  "value": "4.16",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][weight]",
                  "value": "0",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][internal_shipping_info]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[shipping_infos][api_response]",
                  "value": "",
                  "type": "text"
                },
                {
                  "key": "cart[client][type]",
                  "value": "none",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sales rule subtotal 200+",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Test that the H20 coupon is valid in cart\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(1);",
                  "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"1\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "action",
                  "value": "{{framework_action_check_cart}}",
                  "type": "text"
                },
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][item_number]",
                  "value": "1266",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][quantity]",
                  "value": "3",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][internal_order_info]",
                  "value": "{\"store_view_id\":\"1\", \"product_id\":\"1266\",\"item_type\":\"simple\", \"exchange_rate\":\"1\"}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            },
            "description": "Adds a sales rule for sub-totals over 200, excludes the sale category items"
          },
          "response": []
        },
        {
          "name": "Invalid Coupon Code",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Test that the H20 coupon is valid in cart\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.external_coupons[0].is_valid).to.eql(false);",
                  "    pm.expect(jsonData.external_coupons[0].code).to.eql(\"INACTIVE_CODE\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "action",
                  "value": "{{framework_action_check_cart}}",
                  "type": "text"
                },
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "cart[items][0][internal_order_info]",
                  "value": "{\"store_view_id\":\"1\", \"product_id\":\"15\",\"item_type\":\"simple\", \"exchange_rate\":\"1\"}",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][code]",
                  "value": "INACTIVE_CODE",
                  "type": "text"
                },
                {
                  "key": "cart[external_coupons][0][internal_info]",
                  "value": "{\"coupon_id\":\"999999\"}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "cron",
      "item": [
        {
          "name": "Shipping",
          "item": [
            {
              "name": "SG: addOrder",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "const jsonData = pm.response.json();",
                      "pm.test(\"Order added properly\", function () {",
                      "    pm.expect(jsonData).to.have.ownProperty('error').to.eq(0);",
                      "    pm.expect(jsonData).to.have.ownProperty('external_order_id').to.not.be.empty;",
                      "    pm.expect(jsonData).to.have.ownProperty('external_order_number').to.not.be.empty;",
                      "});",
                      "",
                      "pm.test(\"Save order id\", function () {",
                      "    const order_number = Utility.getRequestVariableValue('order_number');",
                      "    pm.environment.set(\"gen_order_\" + order_number + \"_id\", jsonData.external_order_id);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_add_order}}",
                      "type": "text"
                    },
                    {
                      "key": "order_number",
                      "value": "0001",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "get mage order item id",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "if (jsonData.hasOwnProperty('items') && jsonData.items.length > 0) {",
                      "    pm.environment.set(\"order_item_id\", jsonData.items[0].item_id);",
                      "}",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{gen_adminToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest_default}}/V1/orders/{{gen_order_0001_id}}",
                  "host": [
                    "{{m2_rest_default}}"
                  ],
                  "path": [
                    "V1",
                    "orders",
                    "{{gen_order_0001_id}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "ship order partially",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "    pm.environment.set(\"gen_shipment_id\", pm.response.text().replace(/['\"]+/g, ''));   ",
                      "});",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "pm.environment.unset(\"gen_shipment_id\");"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{gen_adminToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"items\": [\n    {\n      \"order_item_id\": \"{{order_item_id}}\",\n      \"qty\": 1\n    }\n  ],\n  \"tracks\": [\n    {\n      \"track_number\": \"1Y-9876543210\",\n      \"title\": \"United Parcel Service\",\n      \"carrier_code\": \"ups\"\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{m2_rest_default}}/V1/order/{{gen_order_0001_id}}/ship",
                  "host": [
                    "{{m2_rest_default}}"
                  ],
                  "path": [
                    "V1",
                    "order",
                    "{{gen_order_0001_id}}",
                    "ship"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "cron: ship",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_cron}}",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_name]",
                      "value": "set_shipping_completed",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_params]",
                      "value": "0",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "get SG order",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "pm.test(\"Shipment is present\", function () {",
                      "    pm.expect(jsonData.reported_shipping_collections.length).to.eql(1);",
                      "    pm.expect(jsonData.reported_shipping_collections).to.contain(pm.environment.get('gen_shipment_id'));",
                      "});",
                      "",
                      "pm.test(\"Is not sent to shopgate as the order is not fulfilled\", function () {",
                      "    pm.expect(jsonData.is_sent_to_shopgate).to.eql(0);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "// Retrieve magento 2 API key",
                      "const key = pm.environment.get(\"m2_api_key\")",
                      "if (!key) {",
                      "    const url = pm.environment.get(\"mage_domain\") + '/rest/default/V1/integration/admin/token'",
                      "    const postRequest = {",
                      "      url: url,",
                      "      method: 'POST',",
                      "      header: 'Content-Type:application/json',",
                      "      body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "        \t\"username\": pm.environment.get(\"admin_user\"),",
                      "        \t\"password\": pm.environment.get(\"admin_pass\")",
                      "        })",
                      "      }",
                      "    };",
                      "   pm.sendRequest(postRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.log(err);",
                      "    } else {",
                      "        pm.environment.set(\"m2_api_key\", response.text().replace(/['\"]+/g, ''));",
                      "    }",
                      "}); ",
                      "}",
                      "",
                      "",
                      "",
                      "",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{gen_adminToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest_default}}/V1/shopgate/order/mage/{{gen_order_0001_id}}",
                  "host": [
                    "{{m2_rest_default}}"
                  ],
                  "path": [
                    "V1",
                    "shopgate",
                    "order",
                    "mage",
                    "{{gen_order_0001_id}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "ship order completely",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "    pm.environment.set(\"gen_shipment_id\", pm.response.text().replace(/['\"]+/g, '')); ",
                      "});",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "pm.environment.unset(\"gen_shipment_id\");"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{gen_adminToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"items\": [\n    {\n      \"order_item_id\": \"{{order_item_id}}\",\n      \"qty\": 1\n    }\n  ],\n  \"tracks\": [\n    {\n      \"track_number\": \"1Y-9876543210\",\n      \"title\": \"United Parcel Service\",\n      \"carrier_code\": \"ups\"\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{m2_rest_default}}/V1/order/{{gen_order_0001_id}}/ship",
                  "host": [
                    "{{m2_rest_default}}"
                  ],
                  "path": [
                    "V1",
                    "order",
                    "{{gen_order_0001_id}}",
                    "ship"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "cron: ship",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_cron}}",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_name]",
                      "value": "set_shipping_completed",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_params]",
                      "value": "0",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "is SG order sent?",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "pm.test(\"2 shipments are present\", function () {",
                      "    pm.expect(jsonData.reported_shipping_collections.length).to.eql(2);",
                      "    pm.expect(jsonData.reported_shipping_collections).to.contain(pm.environment.get('gen_shipment_id'));",
                      "});",
                      "",
                      "pm.test(\"Is sent to shopgate as the order is fulfilled\", function () {",
                      "    pm.expect(jsonData.is_sent_to_shopgate).to.eql(1);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{gen_adminToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest_default}}/V1/shopgate/order/mage/{{gen_order_0001_id}}",
                  "host": [
                    "{{m2_rest_default}}"
                  ],
                  "path": [
                    "V1",
                    "shopgate",
                    "order",
                    "mage",
                    "{{gen_order_0001_id}}"
                  ]
                }
              },
              "response": []
            }
          ],
          "description": "Tests shipping cron. Ships 1 item at first, then checks that the is_sent is not set so that it can send the order to shopgate when it is fully shipped."
        },
        {
          "name": "Cancel Orders",
          "item": [
            {
              "name": "SG: addOrder",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "const jsonData = pm.response.json();",
                      "pm.test(\"Order added properly\", function () {",
                      "    pm.expect(jsonData).to.have.ownProperty('error').to.eq(0);",
                      "    pm.expect(jsonData).to.have.ownProperty('external_order_id').to.not.be.empty;",
                      "    pm.expect(jsonData).to.have.ownProperty('external_order_number').to.not.be.empty;",
                      "});",
                      "",
                      "pm.test(\"Save order id\", function () {",
                      "    const order_number = Utility.getRequestVariableValue('order_number');",
                      "    pm.environment.set(\"gen_order_\" + order_number + \"_id\", jsonData.external_order_id);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_add_order}}",
                      "type": "text"
                    },
                    {
                      "key": "order_number",
                      "value": "0001",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "M2: get SG order",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "pm.test(\"Cancellation is not sent to shopgate\", function () {",
                      "    pm.expect(jsonData.is_cancellation_sent_to_shopgate).to.eql(0);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{gen_adminToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest_default}}/V1/shopgate/order/mage/{{gen_order_0001_id}}",
                  "host": [
                    "{{m2_rest_default}}"
                  ],
                  "path": [
                    "V1",
                    "shopgate",
                    "order",
                    "mage",
                    "{{gen_order_0001_id}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "M2: cancel order",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Make sure order was cancelled\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData, 'Order not cancelled for some reason').to.eql(true);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{gen_adminToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"items\": [\n    {\n      \"order_item_id\": \"{{order_item_id}}\",\n      \"qty\": 1\n    }\n  ],\n  \"tracks\": [\n    {\n      \"track_number\": \"1Y-9876543210\",\n      \"title\": \"United Parcel Service\",\n      \"carrier_code\": \"ups\"\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{m2_rest_default}}/V1/orders/{{gen_order_0001_id}}/cancel",
                  "host": [
                    "{{m2_rest_default}}"
                  ],
                  "path": [
                    "V1",
                    "orders",
                    "{{gen_order_0001_id}}",
                    "cancel"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "cron: cancel_orders",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "type": "text/javascript",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "*/*"
                  },
                  {
                    "key": "X-Shopgate-Auth-User",
                    "value": "{{sgHeaderAuthUser}}"
                  },
                  {
                    "key": "X-Shopgate-Auth-Token",
                    "value": "{{sgHeaderAuthToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "shop_number",
                      "value": "{{shop_number}}",
                      "type": "text"
                    },
                    {
                      "key": "action",
                      "value": "{{framework_action_cron}}",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_name]",
                      "value": "cancel_orders",
                      "type": "text"
                    },
                    {
                      "key": "jobs[0][job_params]",
                      "value": "0",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{domain}}",
                  "host": [
                    "{{domain}}"
                  ]
                }
              },
              "response": []
            },
            {
              "name": "is SG order sent?",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "pm.test(\"Cancellation is sent to shopgate\", function () {",
                      "    pm.expect(jsonData.is_cancellation_sent_to_shopgate).to.eql(1);",
                      "});",
                      "",
                      "pm.test(\"No shipments are done\", function () {",
                      "    pm.expect(jsonData.reported_shipping_collections.length).to.eql(0);",
                      "});",
                      "",
                      "pm.test(\"Shipping is not sent to shopgate\", function () {",
                      "    pm.expect(jsonData.is_sent_to_shopgate).to.eql(0);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{gen_adminToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{m2_rest_default}}/V1/shopgate/order/mage/{{gen_order_0001_id}}",
                  "host": [
                    "{{m2_rest_default}}"
                  ],
                  "path": [
                    "V1",
                    "shopgate",
                    "order",
                    "mage",
                    "{{gen_order_0001_id}}"
                  ]
                }
              },
              "response": []
            }
          ],
          "description": "Tests shipping cron. Ships 1 item at first, then checks that the is_sent is not set so that it can send the order to shopgate when it is fully shipped."
        }
      ]
    },
    {
      "name": "add_order",
      "item": [
        {
          "name": "SG: addOrder",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "pm.test(\"Order added properly\", function () {",
                  "    pm.expect(jsonData).to.have.ownProperty('error').to.eq(0);",
                  "    pm.expect(jsonData).to.have.ownProperty('external_order_id').to.not.be.empty;",
                  "    pm.expect(jsonData).to.have.ownProperty('external_order_number').to.not.be.empty;",
                  "});",
                  "",
                  "pm.test(\"Save order id\", function () {",
                  "    const order_number = Utility.getRequestVariableValue('order_number');",
                  "    pm.environment.set(\"gen_order_\" + order_number + \"_id\", jsonData.external_order_id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "*/*"
              },
              {
                "key": "X-Shopgate-Auth-User",
                "value": "{{sgHeaderAuthUser}}"
              },
              {
                "key": "X-Shopgate-Auth-Token",
                "value": "{{sgHeaderAuthToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "shop_number",
                  "value": "{{shop_number}}",
                  "type": "text"
                },
                {
                  "key": "action",
                  "value": "{{framework_action_add_order}}",
                  "type": "text"
                },
                {
                  "key": "order_number",
                  "value": "0003",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{domain}}",
              "host": [
                "{{domain}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "check coupon code",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "pm.test(\"Coupon check\", function () {",
                  "    pm.expect(jsonData.coupon_code, 'No coupon registered').to.not.be.undefined;",
                  "    pm.expect(jsonData.coupon_code).to.eq('APP10');",
                  "});",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{gen_adminToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{m2_rest_default}}/V1/orders/{{gen_order_0003_id}}",
              "host": [
                "{{m2_rest_default}}"
              ],
              "path": [
                "V1",
                "orders",
                "{{gen_order_0003_id}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "get_settings",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Test payload with correct data returned', function() {",
              "    const jsonData = pm.response.json();",
              "    const taxRate = jsonData.tax.tax_rates.pop();",
              "    pm.expect(taxRate.state).to.eq('US-MI');",
              "    pm.expect(taxRate.country).to.eq('US');",
              "    pm.expect(taxRate.tax_percent).to.eq(8.25);",
              "    const customerGroup = jsonData.customer_groups.pop();",
              "    pm.expect(customerGroup.name).to.eq('Retailer');",
              "    pm.expect(customerGroup.customer_tax_class_key).to.eq('Retail Customer');",
              "    pm.expect(jsonData.allowed_address_countries.length).to.be.gt(0);",
              "    pm.expect(jsonData.allowed_shipping_countries.length).to.be.gt(0);",
              "    pm.expect(jsonData.payment_methods.length).to.be.eq(3);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_get_settings}}",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "ping",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "var jsonData = pm.response.json();",
              "pm.test(\"Ping Pong\", function () {",
              "    pm.expect(jsonData.pong).to.eql('OK');",
              "});",
              "",
              "pm.test(\"Check basic config data\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.configuration.customer_number).to.eql('XXXXXXXX');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Accept",
            "value": "*/*"
          },
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_ping}}",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "getReviews",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Not an error\", function () {",
              "    pm.response.to.not.have.jsonBody('error');",
              "});",
              "",
              "pm.test(\"have reviews\", function () {",
              "    var jsonObject = xml2Json(responseBody);",
              "    pm.expect(jsonObject.reviews.review).to.have.property('item_uid');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Accept",
            "value": "*/*"
          },
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_get_reviews}}",
              "type": "text"
            },
            {
              "key": "limit",
              "value": "1",
              "type": "text"
            },
            {
              "key": "offset",
              "value": "1",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "get_customer",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const jsonData = pm.response.json();",
              "pm.test(\"Check customer data\", function () {",
              "    pm.expect(jsonData.user_data.gender).to.eql('f');",
              "    pm.expect(jsonData.user_data.birthday).to.eql('1973-12-15');",
              "    const address = jsonData.addresses.pop();",
              "    pm.expect(address.country).to.eql('US');",
              "    pm.expect(address.state).to.eql('US-MI');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Accept",
            "value": "*/*"
          },
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_get_customer}}",
              "type": "text"
            },
            {
              "key": "user",
              "value": "roni_cost@example.com",
              "type": "text"
            },
            {
              "key": "pass",
              "value": "roni_cost3@example.com",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "getCategories",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Not an error\", function () {",
              "    pm.response.to.not.have.jsonBody('error');",
              "});",
              "",
              "pm.test(\"have categories\", function () {",
              "    var jsonObject = xml2Json(responseBody);",
              "    pm.expect(jsonObject.categories.category).to.have.property('name');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Accept",
            "value": "*/*"
          },
          {
            "key": "X-Shopgate-Auth-User",
            "value": "{{sgHeaderAuthUser}}"
          },
          {
            "key": "X-Shopgate-Auth-Token",
            "value": "{{sgHeaderAuthToken}}"
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "shop_number",
              "value": "{{shop_number}}",
              "type": "text"
            },
            {
              "key": "action",
              "value": "{{framework_action_get_categories}}",
              "type": "text"
            },
            {
              "key": "limit",
              "value": "1",
              "type": "text"
            },
            {
              "key": "offset",
              "value": "1",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{domain}}",
          "host": [
            "{{domain}}"
          ]
        }
      },
      "response": []
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "var tstamp = Math.floor(Date.now() / 1000);",
          "",
          "// Use the CryptoJS",
          "var authUser = pm.environment.get('customer_number') + \"-\" + tstamp;",
          "var tokenData = \"SPA-\" + pm.environment.get('customer_number') + \"-\" + tstamp + \"-\" + pm.environment.get('api_key');",
          "",
          "var authToken = CryptoJS.SHA1(tokenData).toString();",
          "",
          "// Set the new header values",
          "pm.environment.set(\"sgHeaderAuthUser\", authUser);",
          "pm.environment.set(\"sgHeaderAuthToken\", authToken);",
          "",
          "/**",
          " * Global utility functions",
          " */",
          "Utility = {};",
          "// some times request values are calculated, this is how we get them",
          "Utility.getRequestVariableValue = function(incomingKey) {",
          "    const found = pm.request.body.formdata.find(function({key}) {",
          "        return key === incomingKey;",
          "    });",
          "    return found && found.hasOwnProperty('value') ? found.value : null;",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// remove key if it is invalid",
          "if (pm.response.code === 401) {",
          "    pm.environment.unset(\"m2_api_key\");",
          "}"
        ]
      }
    }
  ]
}
